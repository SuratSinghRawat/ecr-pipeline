pipeline{
    agent none
    environment{
        AWS_ACCOUNT_ID="211125636900"
        AWS_DEFAULT_REGION="ap-south-1"
        AWS_REPO_NAME="react-spring-mongo/reactapp"
        IMAGE_TAG="1"
        REPOSITORY_URL="211125636900.dkr.ecr.ap-south-1.amazonaws.com/react-spring-mongo/reactapp"
    }
    stages{
        stage("loggin in ECR Repo")
        {
          agent{ label 'jenkins-agent-sonar'}
          steps{
                script{
                    sh "aws ecr get-login-password --region ap-south-1| docker login --username AWS --password-stdin 211125636900.dkr.ecr.ap-south-1.amazonaws.com"
                }
          }

        }
        stage("git clone")
        {
            agent{ label 'jenkins-agent-sonar'}
            steps{
                git branch: 'main', url: 'https://github.com/SuratSinghRawat/ecr-pipeline.git'                

            }
        }
        stage("bulid image")
        {
            agent{ label 'jenkins-agent-sonar'}
            steps{
                sh "sudo docker tag reactapp:1 211125636900.dkr.ecr.ap-south-1.amazonaws.com/react-spring-mongo/reactapp:1"                 

            }
        }
    }

}